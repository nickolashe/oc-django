{% load staticfiles %}

<!DOCTYPE html>
<html>
  <head>
    {% include "partials/head.html" %}
  </head>

  <body>

    {% include "partials/header.html" %}
    
    <div id="container" class="js-close-any" canvas="container">
      <div id="wrapper">
        {% if status_msg %}
        <div class="alert row half-margin-top">
          {{ status_msg }}
        </div>
        {% endif %}

        <div class="row">
          <div class="small-12 columns">
            <h3 class="title-sub">Invite volunteers</h3>

            {% if event_project_name %}
              <p>to help <strong>{{ event_project_name }}</strong></p>
            {% else %}
              <p>to join the community and record hours with {{ orgname }}</p>
            {% endif %}

            <p><a class="personal-message-popup_open button tiny round secondary">
              Add personal message
            </a></p>
          </div>
        </div>
        <form action ="" name="theForm" id="form_id" method="post">
        {% csrf_token %}
          <div class="row center">
            <div class="small-12 medium-8 small-centered columns">
              <div id="vol-invites-box" name="vol-invites-box" class="row">
                <div class="small-6 columns">
                  <input type="text" name="vol-name-1" placeholder="First name (optional)" />
                </div>
                <div class="small-6 columns">
                  <input type="text" name="vol-email-1" placeholder="Email" />
                </div>

                <div class="small-6 columns">
                  <input type="text" name="vol-name-2" placeholder="First name" />
                </div>
                <div class="small-6 columns">
                  <input type="text" name="vol-email-2" placeholder="Email" />
                </div>

                <div class="small-6 columns">
                  <input type="text" name="vol-name-3" placeholder="First name" />
                </div>
                <div class="small-6 columns">
                  <input type="text" name="vol-email-3" placeholder="Email" />
                </div>
              </div>

              <div class="row one-margin-bottom left">
                <div class="column">
                  <a id="add-volunteer" class="blue-icon"><i class="fa fa-plus-circle half-margin-left half-margin-right"></i>Add volunteer</a> or <a class="bulk-email-popup_open">add many at once</a>
                </div>
              </div>

              <div id="personal-message-div" class="left hidden">
                <label for="personal-message-submit">Personal message</label>
                <textarea id="personal-message-submit"></textarea>
              </div>
            </div>

            <!--<a href="{% url 'openCurrents:org-admin' %}" class="button round secondary">Send invites</a>-->
            <button type='submit' id="button_1" class="button round half-margin-top">Send invites<input type="hidden" id="count-vol" name="count-vol" value="3" /></button>
          </div>

          <p class="no-margin-bottom"><a class="preview-email-popup_open button tiny round secondary">
            Preview email
          </a></p>

          {% if skip == 1 %}
            <a href="{% url 'openCurrents:org-admin' num_vols=0 %}">Skip for now</a>
          {% endif %}
          <input type="hidden" id="bulk-vol" name="bulk-vol" value="" />
        </form>

        <div id="push"></div>

      <!-- wrapper div-->
      </div>
      
      {% include 'partials/footer.html' %}
            
    <!--container div -->
    </div>


    <div id="bottom-stripe" class="full-width"></div>

    <div off-canvas="menu right shift" id="menu">
      {% include 'partials/menu.html' %}
    </div>

    <div id="personal-message-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <h5 class="popup-title">A message from {{ user.first_name }}:</h5>
      </div>

      <div class="row center">
        <div class="medium-10 small-centered column">
          <textarea id="personal-message-typed" placeholder="Your message (optional)"></textarea>
        </div>
      </div>

      <div class="center">
        <a id="save-message" class="personal-message-popup_close button round small">
          Save
        </a>
        <a class="personal-message-popup_close button round small secondary">
          Cancel
        </a>
      </div>
    </div>

    <div id="preview-email-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <h4 class="popup-title">Email preview</h4>
      </div>

      <div class="row left">
        <div class="medium-10 small-centered column">
          <label>Subject</label>
          <p><strong>An invitation from {{ orgname }}</strong></p>

          <label>Body</label>
          <p>{{ user.first_name }} {{ user.last_name }} has invited you to 
            {% if event_project_name %}
              a volunteer event
            {% else %}
              openCurrents
            {% endif %}
            
            <span id="personal-message-detail" class="hidden">
              and sent a message:
            </span>
          </p>

          <p id="personal-message-preview" class="hidden"></p>

          {% if event_project_name %}
            <p>Let's {{ event_project_name }} with {{ orgname }}<br/>
              Event date, time, and location
            </p>
          {% endif %}

          <p>openCurrents rewards you for giving time to {{ orgname }} and other social organizations. Click the link below to learn moreÂ and create your account:</p>

          <p><a href="http://www.opencurrents.com" target="_blank">
            openCurrents.com
          </a></p>

          <p>You can also reach out to {{ user.first_name }} by replying to this email.</p>
        </div>
      </div>

      <div class="center">
        <a class="preview-email-popup_close button round small">
          Got it
        </a>
      </div>
    </div>

    <div id="bulk-email-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <h3 class="popup-title">Add email list</h3>
      </div>

      <div class="row center">
        <div class="medium-10 small-centered column">
          <p>Add multiple emails separated by spaces, new lines, or commas:</p>
          <textarea name="bulk-emails" id = "bulk-emails" placeholder="email@yahoo.com, address@aol.com" rows="3"></textarea>

          <p><a id="add-message-bulk" class="half-margin-bottom">Add personal message</a></p>

          <div id="personal-message-bulk" class="one-margin-bottom hidden">
            A message from {{ user.first_name }} {{ user.last_name }}:
            <textarea placeholder="Your message (optional)"></textarea>
          </div>

          <!--<p class="three-halves-margin-top"><a onclick="$(this).closest('form').submit()" href="" class="button round">Send invites</a></p>-->
        <button type='submit' name="button_2" onclick="submit_from_bulk()" class="button round">Send invites</button>

        </div>
      </div>
    </div>

    <script type="text/javascript">
      $(document).ready(function(){

        // Add volunteers
        var vols = 3;

        $('#add-volunteer').click(function() {

          vols ++;
          document.getElementById('count-vol').value = vols;//$('#count-vol').value = vols;

          $('#vol-invites-box').append('<div class="hidden slide small-6 columns"><input type="text" name="vol-name-'+vols+'" id="vol-name-'+vols+'" placeholder="First name" /></div><div class="hidden small-6 columns"><input type="text" name="vol-email-'+vols+'" id="vol-email-'+vols+'" placeholder="Email" /></div>');
          $('#vol-invites-box .hidden').slideDown();
        });

        // Copy personal message from popup to input in form
        $('#save-message').click(function(){
          var text = $('#personal-message-typed').val();
          $('#personal-message-submit').val(text);
          $('#personal-message-div').show();
          $('#personal-message-detail').show();
          $('#personal-message-preview').show().text(text);
        });

        // Copy personal message from input to preview email
        $('#personal-message-div').on('input', function(){
          var text = $('#personal-message-submit').val();
          $('#personal-message-preview').show().text(text);

          // if user clears the message, hide 'and sent you a message' in preview
          if ($('#personal-message-submit').val() == '') {
            $('#personal-message-detail').hide();
          };
        });

        $('#add-message-bulk').click(function(){
          $(this).hide();
          $('#personal-message-bulk').slideDown();
        });
      });

      $('#bulk-email-popup, #personal-message-popup, #preview-email-popup').popup({
        vertical: 'top',
        transition: 'all 0.75s',
        scrolllock: true,
      });

      function submit_from_bulk(){

          document.getElementById("bulk-vol").value = document.getElementById("bulk-emails").value;
          document.forms.theForm.submit();
      }
    </script>

    <script type="text/javascript" src="{% static "js/end_scripts.js" %}"></script>
  </body>
</html>
