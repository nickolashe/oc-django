{% load staticfiles %}
{% load tags %}

<!DOCTYPE html>
<html>
  <head>
    {% include "partials/head.html" %}

    {% block head %}{% endblock head %}
  </head>

  <body>
    {% include "partials/header.html" %}

    <div id="container" class="js-close-any" canvas="container">
      <div id="wrapper">

        {% if status_msg %}
        <div class="success row half-margin-top">
          {{status_msg}}
        </div>
        {% endif %}


        <div class="row">
          <div class="small-12 small-centered columns">
            <h5 class="two-margin-top no-margin-bottom">{{ user.first_name }} {{ user.last_name }}</h5>


            {% if is_admin %}
              <h6 class="inline half-margin-right">{{orgname}}</h6>
              <a href="{% url 'openCurrents:org-admin' %}"><i class="fa fa-lg fa-gear"></i></a>
            {% endif %}

            <p class="half-margin-top half-margin-bottom">
              <a class="earn-currents-popup_open button round small">Volunteer</a>
            </p>

            <div class="row">
              <div class="small-12 medium-6 columns">
                <h6 class="inline-block qtr-margin-bottom">Currents available: </h6>
                <img class="h6-symbol" src="{% static 'img/symbol.svg' %}"/><h6 class="inline-block no-margin-bottom">{{ user_balance_verified }}</h6>
                <p class="grey half-margin-bottom">Pending: <img class="med-text-symbol" src="{% static 'img/symbol.svg' %}"/>{{ user_balance_pending }}</p>
                <p class="no-margin-bottom">
                  <a href="{% url 'openCurrents:marketplace' %}" class="button round secondary tiny">
                    Redeem
                  </a>
                </p>
              </div>

              <div class="small-12 medium-6 columns">
                <h6 class="qtr-margin-bottom">Dollars available: $(20)</h6>
                <p class="grey half-margin-bottom">Pending: $(10)</p>
                
                <!-- if available_dollars this button should have class cash-out-popup_open else no-cash-popup_open -->
                <a class="cash-out-popup_open button round secondary tiny">
                  Cash out
                </a>
              </div>
            </div>
          </div>
        </div>

        <div class="row collapse three-halves-margin-top left">
          <div class="small-11 medium-10 small-centered columns">
            <h6 class="half-margin-bottom">My upcoming events</h6>
            {% if events_upcoming %}
              {% for event in events_upcoming %}
                {% if event.project.name != "ManualTracking" %}
                <div class="row one-margin-bottom">
                  <div class="left small-9 columns">
                    <strong>Let's {{event.project.name}}!</strong>
                    with {{event.project.org.name}} 
                    on {{event.datetime_start|day:timezone}}
                    from {{event.datetime_start|time:timezone}}
                    to {{event.datetime_end|time:timezone}}
                    at {{event.location}}
                  </div>

                  <div class="right relative small-3 columns">
                    <a class="mini-open"><i class="blue half-margin-right fa-chevron-circle-down fa fa-lg"></i></a>
                    <ul class="mini-menu">
                      <a href="{% url 'openCurrents:event-detail' event.id %}"><li>View event details</li></a>
                    </ul>
                  </div>
                </div>
                {% endif %}
              {% endfor %}
            {% else %}
              <p>You are not registered for any upcoming events. 
                <a href="{% url 'openCurrents:upcoming-events' %}">
                  Find one!
                </a>
              </p>
            {% endif %}
          </div>
        </div>
        
        <div class="row collapse one-margin-top left">
          <div class="small-11 medium-10 small-centered columns">
            <div class="row">
              <div class="small-8 columns">
                <h6 class="half-margin-bottom">My redeemed offers</h6>
              </div>

              <div class="right small-4 columns">
                <!-- % if offers_redeemed % -->
                <h6 class="half-margin-bottom">Status</h6>
                <!-- % endif % -->
              </div>
            </div>

            {% if offers_redeemed %}
              {% for offer_redeemed in offers_redeemed %}
                {% with offer=offer_redeemed.transaction.offer %}
                  <div class="row one-margin-bottom">
                    <div class="left small-9 columns">
                      <strong>
                        {{ offer.org.name }}
                      </strong>
                      accepts Currents for {{ offer.currents_share }} of flat tire fixes
                    </div>

                    <div class="right relative small-3 columns">
                      <p> {{ offer_redeemed.get_action_type_display }} </p>
                    </div>
                  </div>
                {% endwith %}
              {% endfor %}
            {% else %}
              <p>You have not yet redeemed any offers. Check out the 
                <a href="{% url 'openCurrents:marketplace' %}">
                  marketplace!
                </a>
              </p>
            {% endif %}

          </div>
        </div>


        <!-- community feed code. Hardcoded not dynamic -->
        <!-- <div class="row full-width collapse one-margin-bottom">
          <div class="left small-11 medium-10 large-8 small-centered columns">
            <h6 class="one-margin-top one-margin-bottom">Community activity</h6>
            <div id="community-feed">
              <div class="feed-item">
                <strong>Jacob Jacobs</strong> joined openCurrents!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> created a project: <strong><a>Let's clean up Lady Bird Lake<span class="no-wrap">!<i class="half-margin-left fa fa-arrow-circle-right"></i></span></a></strong>
              </div>

              <div class="feed-item">
                <strong>Jacob Jacobs</strong> will be helping <strong>Keep Austin Beautiful</strong> clean up Lady Bird Lake!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> issued 2 Currents to <strong>Jacob Jacobs</strong>.
              </div>
              <div class="feed-item">
                <strong>Jacob Jacobs</strong> joined openCurrents!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> created a project: <strong><a>Let's clean up Lady Bird Lake<span class="no-wrap">!<i class="half-margin-left fa fa-arrow-circle-right"></i></span></a></strong>
              </div>

              <div class="feed-item">
                <strong>Jacob Jacobs</strong> will be helping <strong>Keep Austin Beautiful</strong> clean up Lady Bird Lake!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> issued 2 Currents to <strong>Jacob Jacobs</strong>.
              </div>
              <div class="feed-item">
                <strong>Jacob Jacobs</strong> joined openCurrents!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> created a project: <strong><a>Let's clean up Lady Bird Lake<span class="no-wrap">!<i class="half-margin-left fa fa-arrow-circle-right"></i></span></a></strong>
              </div>

              <div class="feed-item">
                <strong>Jacob Jacobs</strong> will be helping <strong>Keep Austin Beautiful</strong> clean up Lady Bird Lake!
              </div>

              <div class="feed-item">
                <strong>Keep Austin Beautiful</strong> issued 2 Currents to <strong>Jacob Jacobs</strong>.
              </div>
            </div>
          </div>
        </div> -->
            <!-- <h5 class="fit-left">I care about</h5>
            <span class="input-sizer"><input name="offer-text" type="text" class="profile-text" value="showing people their power"/></span>

            <div class="tag-block">
              <button class="button round tiny">Nature</button>
            </div>

            <h5 class="fit-left">I offer</h5>
            <span class="input-sizer"><input name="offer-text" type="text" class="profile-text" /></span>

            <h5 class="fit-left">I am looking for</h5>
            <span class="input-sizer"><input name="offer-text" type="text" class="profile-text" /></span> -->

            <!--<h5 class="one-margin-top one-margin-bottom">My badges</h5>

            <h5 class="one-margin-top one-margin-bottom">My hours given</h5>
            -->


        <div id="push"></div>

      <!-- wrapper div-->
      </div>

      {% include 'partials/footer.html' %}

    <!--container div -->
    </div>

    <div id="bottom-stripe" class="full-width"></div>

    <div off-canvas="menu right shift" id="menu">
      {% include 'partials/menu.html' %}
    </div>

    <div id="welcome-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <div class="small-centered medium-10 columns">
          <h3 class="one-margin-top">Welcome to openCurrents!</h3>
          <p class="three-halves-margin-top">We're excited to have you with us in the community. You are now able to start creating Currents with our pilot nonprofits! Soon you will be able to exchange Currents through a digital marketplace and see what like minded peers are doing in your community.</p>

          <p>If you'd like to learn more about openCurrents or get involved, let us know!</p>

          <p class="three-halves-margin-top">
            <a href="javascript:void(Tawk_API.toggle())" class="button round small">Get in touch</a>
            <a class="welcome-popup_close button round small secondary">Close</a>
          </p>
        </div>
      </div>
    </div>

    <div id="earn-currents-popup" class="modal center small-12 medium-10 large-8 small-centered columns">
      <div class="row center">
        <h3 class="one-margin-top">2 ways to create Currents</h3>
        <h6></h6>
      </div>

      <div class="row center half-margin-top">
        <div class="half-margin-bottom small-12 medium-6 columns">
          <h6>Volunteer at an event</h6>
          <p>Check out these upcoming opportunities with participating organizations:</p>
          <a href="{% url 'openCurrents:upcoming-events' %}" class="button round small">View upcoming events</a>
        </div>

        <div class="small-12 medium-6 columns">
          <h6>Track volunteer time</h6>
          <p>If you already give time with a participating organization, track your hours here:</p>
          <a href="{% url 'openCurrents:time-tracker' %}" class="button round small">Record hours</a>
        </div>
      </div>
    </div>

    <div id="no-cash-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <h3 class="popup-title">No dollars available</h3>
      </div>

      <div class="row center one-margin-top">
        <div class="small-centered medium-10 columns">
          <p>You do not yet have dollars available to transfer to your bank account. If you have redeemed an offer and have pending dollars in your account, you'll need to wait until the business verifies your proof of purchase at the end of the month.</p>
          <p>To see offers from businesses in the community, please visit the marketplace by clicking "Redeem" in your profile.</p>
          <a class="no-cash-popup_close button round">Got it</a>
        </div>
      </div>
    </div>

    <div id="cash-out-popup" class="modal center small-12 medium-9 small-centered columns">
      <div class="row center">
        <h3 class="popup-title">Confirm cash out</h3>
      </div>

      <form>
        <div class="row center">
          <div class="small-centered medium-10 columns">
            <p class="three-halves-margin-bottom">openCurrents uses Dwolla to send you cash because money goes directly to your bank account. You will receive an email in the next 48 hours inviting you to create a Dwolla account and receive your cash. If you have any questions, don't hesitate to reach out.</p>

            <a class="button round">Send cash</a>
            <a href="javascript:void(Tawk_API.toggle())" class="button round secondary">Contact us</a>
          </div>
        </div>
      </form>
    </div>

    <div id="rsvp-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <h3 class="popup-title">Change RSVP</h3>
      </div>

      <div class="row center one-margin-top">
        <div class="small-centered medium-10 columns">

          <input type="radio" id="rsvp-1" name="rsvp-[]" value="" class="hidden styled-radio" checked/>
            <label for="rsvp-1" class="button round secondary small">Going</label>

          <input type="radio" id="rsvp-2" name="rsvp-[]" value="" class="hidden styled-radio"/>
            <label for="rsvp-2" class="button round secondary small">Maybe</label>

          <input type="radio" id="rsvp-3" name="rsvp-[]" value="" class="hidden styled-radio"/>
            <label for="rsvp-3" class="button round secondary small">Not going</label>

          <div class="three-halves-margin-top">
            <button type="submit" class="rsvp-popup_close button round">Update</button>
          </div>
        </div>
      </div>
    </div>
    <div id="approve-hours-popup" class="modal center small-12 medium-9 large-7 small-centered columns">
      <div class="row center">
        <h3 class="popup-title">Volunteers request approval</h3>
      </div>

      <div class="row center">
        <div class="small-centered medium-10 columns">

          <p class="three-halves-margin-bottom">Volunteers have tracked hours and need your signoff before Currents are issued to them. It is recommended that you approve volunteer hours once a week.</p>

          <a href="{% url 'openCurrents:approve-hours' %}" class="button round">View requests</button>
          <a><button class="approve-hours-popup_close button round secondary">Close</button></a>
        </div>
      </div>
    </div>


    <script type="text/javascript">
      $(document).ready(function(){

        if(!localStorage.viewed){
          localStorage.viewed=1;
          var open = true;
        }
        else{
          var open = false;
        }

        $('#rsvp-popup, #earn-currents-popup, #no-cash-popup, #cash-out-popup').popup({
          vertical: 'top',
          transition: 'all 0.75s',
          scrolllock: true,
        });

        $('#welcome-popup').popup({
          vertical: 'top',
          transition: 'all 0.75s',
          scrolllock: true,
          // autoopen: true,
        });

        $('.mini-open').click(function(){
          $('.mini-menu').hide();
          $(this).siblings('.mini-menu').toggle();
          $(this).attr('visibility', 'visible');
        });

        $(document).click(function(e) {
          var target = e.target;
          if (!$(target).is('.mini-open') && !$(target).parents().is('.mini-open')) {
            $('.mini-menu').hide();
          }
        });
      });
    </script>

    <script type="text/javascript">

      if ({{app_hr}}){
          $('#approve-hours-popup').popup({
            vertical: 'top',
            transition: 'all 0.75s',
            scrolllock: true,
            autoopen: true,
          });
      }
    </script>

    <script type="text/javascript" src="{% static "js/end_scripts.js" %}"></script>
  </body>
</html>
